### ğŸ“ Changes


#### 2025-12-29 [22:00]
* **Fix: Editor stability and bounds**
    - Naprawiono zapisy do pamiÄ™ci VGA powodujÄ…ce crash przy otwieraniu edytora â€” `draw_editor()` oraz wszystkie makra zapisu VGA zostaÅ‚y przejrzane i ograniczone do obszaru 80x25.
    - Wprowadzono `CONTENT_COL_OFFSET` i `CONTENT_WIDTH` w `kernel/src/editor.rs`, dziÄ™ki czemu rysowanie treÅ›ci i numerÃ³w linii nie wychodzi poza granice ekranu.
    - Poprawiono logikÄ™ kursora, zawijanie i przesuwanie (`move_cursor_left`, `move_cursor_right`) oraz zabezpieczono `insert_char`, `delete_char`, `backspace` przed indeksacjÄ… poza buforem.

* **Feature: File I/O integration (FAT16 <-> Editor)**
    - `edit_file()` zmienione tak, by przyjmowaÄ‡ nazwÄ™ pliku jako `&[u8; 8]` i `load_file()` teraz Å‚aduje zawartoÅ›Ä‡ pliku z RAMDISKu FAT16 do bufora edytora.
    - Zmieniono `save_file()` w edytorze, aby uÅ¼ywaÄ‡ istniejÄ…cej funkcji `fat16::fat16_save()` i zapisywaÄ‡ aktualny bufor jako plik w RAMDISK.

* **Safety: VGA API & macros**
    - `vga::write_char()` zyskaÅ‚o sprawdzenie granic (80x25) â€” niepoprawne zapisy sÄ… ignorowane zamiast nadpisywaÄ‡ pamiÄ™Ä‡.
    - Makro `write_char_macro!` zostaÅ‚o zastÄ…pione wywoÅ‚aniem `vga::write_char(...)` aby centralnie kontrolowaÄ‡ walidacjÄ™ zapisu.
    - Dodano `vga::set_cursor()` do sterowania kursorem tekstowym (z walidacjÄ… wspÃ³Å‚rzÄ™dnych).

* **Misc: Build script and helpers**
    - `make_kernel.sh` zaktualizowany, aby wymusiÄ‡ `rustup` nightly + `rust-src`, wykonaÄ‡ `cargo clean` przed budowÄ… i poprawnie wygenerowaÄ‡ `release/kernel.bin` (zapobiegaÄ‡ starym binarkom podczas testÃ³w edytora).

#### 2025-12-29 [20:00]
* **Feature: FAT16 RAMDISK support**
    - Dodano wsparcie dla FAT16 w ramdisk (Å‚adowanie i zapisy plikÃ³w w pamiÄ™ci RAM).

#### 2025-12-28 [16:30]
* **Bugfix: Unsafe Operation Warnings (E0133)**
    - Wrapped inline `asm!()` macros and raw pointer dereferences in explicit `unsafe` blocks within `load_polish_fonts()` in `vga.rs`.
    - Fixed Rust 2024 compatibility warnings for unsafe operations inside unsafe functions.
* **Bugfix: Duplicate Build Target Warning**
    - Changed `Cargo.toml` from `[lib]` to `[[bin]]` configuration, eliminating duplicate target warning for `src/main.rs`.
    - Single binary target now builds cleanly without conflicts.
* **Optimization: Bootloader Sector Loading**
    - Increased kernel sector loading from 70 to 140 sectors (~71.5KB) in `boot.asm` to accommodate full Rust kernel binary.
    - Kernel no longer truncates on load; full ~70KB binary is properly transferred to 0x8000.
* **Build Status**:
    - Cargo builds with zero warnings.
    - Boot sector and kernel compile without errors.

#### 2025-12-28 [15:50]
* **Refactor: VBE Graphics Mode Handling**
    - Commented out automatic VBE 1280x720 mode initialization in `boot.asm` to prevent automatic graphics mode on boot.
    - Mode `0x411B` (1280x720, 24/32-bit with LFB) now requires explicit manual triggering instead of auto-initialization.
* **Optimization**: 
    - Removed complex graphics mode implementation to maintain system stability and text mode reliability.
    - Kept text-based menu system as primary interface.
* **F8 Key**: 
    - Reserved for future graphics mode implementation (currently displays placeholder message).

#### 2025-12-28 [14:58]
* **Bugfix: Resolved Linker/Scope Error E0425**
    - Zdefiniowano brakujÄ…cÄ… funkcjÄ™ `get_font_ptr`.
    - Dodano pierwsze bitmapy glifÃ³w (A, B, Crab) do statycznej pamiÄ™ci kernela.
* **Refactor**: 
    - Zmieniono `draw_glyph`, aby poprawnie iterowaÅ‚a po 16 rzÄ™dach bitmapy, zapewniajÄ…c wsparcie dla standardowych wymiarÃ³w fontu konsolowego.
* **Feature: Software Font Renderer**
    - Zaimplementowano funkcjÄ™ `draw_glyph` do rysowania bitmap 8x16 w trybie LFB.
    - Dodano mapowanie bitowe (bit-shifting) dla glifÃ³w, umoÅ¼liwiajÄ…ce renderowanie znakÃ³w piksel po pikselu.
* **Graphics**:
    - Wprowadzono obsÅ‚ugÄ™ kolorÃ³w 24-bit RGB w trybie graficznym.
    - Przygotowano bazÄ™ pod customowe fonty i emoji.

#### 2025-12-28 [14:50]
* **Strategy: UTF-8 & Graphics Roadmap**
    - RozwaÅ¼ono przejÅ›cie na tryb graficzny (Framebuffer) w celu obsÅ‚ugi emoji.
    - Zdefiniowano potrzebÄ™ stworzenia Software Renderera dla glifÃ³w o zmiennej szerokoÅ›ci.
    - Zarezerwowano adres `0x508` na flagÄ™ aktywnego kodowania znakÃ³w.

#### 2025-12-28 [14:35]
* **Feature: Modifier Key Support**
    - Dodano obsÅ‚ugÄ™ kodu skanowania dla lewego klawisza CTRL (0x1D).
    - Wprowadzono system Å›ledzenia stanu klawiszy modyfikujÄ…cych pod adresem `0x507`.
* **Logic Update**: 
    - Przygotowano architekturÄ™ pod obsÅ‚ugÄ™ kombinacji klawiszy (Combo-keys).
* **Feature: Buffer-to-VGA Output**
    - Zaimplementowano odczyt bufora RAM (adres 0x600) po zatwierdzeniu klawiszem Enter.
    - Dodano dynamiczne wyÅ›wietlanie wpisanej komendy na pozycji (0, 22) przed resetem stanu.
* **Logic Fix**: 
    - RozwiÄ…zano problem "znikajÄ…cych danych" poprzez wprowadzenie pÄ™tli iterujÄ…cej po fizycznych adresach pamiÄ™ci przed wyczyszczeniem licznika dÅ‚ugoÅ›ci (0x505).

#### 2025-12-28 [14:30]
* **Architecture: Multi-level State Machine**
    - Wprowadzono adres `0x506` jako flagÄ™ `INPUT_MODE`.
    - Zaimplementowano izolacjÄ™ klawiatury: klawisze alfanumeryczne sÄ… procesowane tylko przy aktywnym `INPUT_MODE`.
* **UI/UX Enhancement**: 
    - Dodano obsÅ‚ugÄ™ klawisza ESC (0x01) jako wyjÅ›cie z trybu wpisywania bez zapisu.
    - Dodano obsÅ‚ugÄ™ Backspace (0x0E) z dynamicznÄ… aktualizacjÄ… bufora RAM i pamiÄ™ci VGA.
* **Memory Map**:
    - `0x500`: Menu State
    - `0x505`: Input Length
    - `0x506`: Input Mode Toggle (0/1)
* **Knowledge: Keyboard Mapping Expansion**
    - Dodano obsÅ‚ugÄ™ kodu skanowania dla klawisza 'I' (0x17).
* **Development Status**: 
    - Rozszerzono tablicÄ™ mapowania ASCII o kolejne litery alfabetu, przygotowujÄ…c system pod obsÅ‚ugÄ™ peÅ‚nych komend tekstowych.

#### 2025-12-28 [01:00]
* **Code Optimizations**
* **Build: Multiboot size flags**
    - W `make_multiboot.sh` dodano `--gc-sections`, strip w `objcopy` oraz optymalizacje rozmiaru w `RUSTFLAGS`, usuwajÄ…c konflikt `lto`/`embed-bitcode`.
    - Dodano Å›cieÅ¼kÄ™ budowy kernela w trybie Multiboot (elf/bin w `release/multiboot/`).
* **UI: MigajÄ…cy prostokÄ…t (Key 4)**
    - Animacja trzech kolorÃ³w (niebieski/czerwony/zielony) z opÃ³Åºnieniem ~800ms zachowana, uproszczona bez tablic i pÄ™tli dla mniejszego kodu.
* **Binary size**
    - Zmniejszono narzut kodu generowanego przez pÄ™tle/zmienne w animacji, co uÅ‚atwia utrzymanie binarki ~25 KB.

#### 2025-12-28 [00:30]
* **Build: GRUB ISO script**
    - Dodano skrypt `make_iso.sh` generujÄ…cy obraz ISO z GRUB i kernel Multiboot (pliki w `release/multiboot/isodir` oraz `release/rusted.iso`).

#### 2025-12-27 [23:25]
* **Feature: Unified Keyboard Polling & State Management**
    - Zaimplementowano makro `poll_keyboard_unified!`, ktÃ³re obsÅ‚uguje logikÄ™ klawiatury w zaleÅ¼noÅ›ci od stanu menu.
    - Wprowadzono system stanÃ³w (State Machine) przechowywany pod statycznym adresem `0x500` (0: Main Menu, 1: Math Menu).
    - Dodano mechanizm "last scancode" pod adresem `0x501`, eliminujÄ…cy powtarzanie akcji przy trzymaniu klawisza.
* **Feature: Interactive Math Menu**
    - Dodano dedykowany tryb obliczeÅ„ matematycznych (`menu_state == 1`).
    - Zaimplementowano operacje: dodawanie, odejmowanie, mnoÅ¼enie i dzielenie z dynamicznym wyÅ›wietlaniem wynikÃ³w ASCII.
    - Zintegrowano generator liczb losowych (`get_random!`) z formatowaniem dziesiÄ™tnym (obsÅ‚uga dziesiÄ…tek i jednoÅ›ci).
* **Feature: Secrets & Animations**
    - Dodano sekwencjÄ™ powitalnÄ… "Welcome on Board" pod klawiszem `9` w Main Menu.
    - Wprowadzono blokadÄ™ animacji (`anim_lock`) pod adresem `0x503`, zapobiegajÄ…cÄ… nakÅ‚adaniu siÄ™ procesÃ³w graficznych.
    - Dodano sygnaturÄ™ autora: `by Klubuntu (github.com/klubuntu)`.

#### 2025-12-27 [23:05]
* **Feature: PRNG (Pseudo-Random Number Generator)**
    - Zaimplementowano generator LCG (Linear Congruential Generator) operujÄ…cy na 64-bitowym ziarnie.
    - Dodano obsÅ‚ugÄ™ instrukcji `rdtsc` przez ASM do inicjalizacji ziarna (seeding).
    - Stworzono makro `get_random!`, udostÄ™pniajÄ…ce losowe liczby `u64` w caÅ‚ym kernelu.
* **Safety**: Zastosowano operacje `wrapping`, aby uniknÄ…Ä‡ bÅ‚Ä™dÃ³w przepeÅ‚nienia (integer overflow) podczas generowania liczb.

#### 2025-12-27 [21:40]
* **Fix: VMA Address & Code Model**
    - Zmieniono `code-model` w `target.json` z `kernel` na `small`.
    - RozwiÄ…zano problem bÅ‚Ä™dnego adresowania (przesuniÄ™cie o 2MB), wymuszajÄ…c poprawne VMA dla sekcji `.text` na poziomie `0x8000`.
* **Optimization: Binary Cleanup**
    - Dodano sekcjÄ™ `/DISCARD/` w `link.ld` dla `.debug*`, `.comment` i `.eh_frame`.
    - Zastosowano flagi `-j .text -j .rodata -j .data` w `llvm-objcopy`.
    - Wyeliminowano metadane i Å›mieci binarne z poczÄ…tku pliku `.bin`, zapewniajÄ…c poprawny start kernela.
* **Feature: Multi-color VGA Macro**
    - Rozbudowano makro `vga_print_ext`, wykorzystujÄ…c rejestry `RSI` (tekst) oraz `RDX` (kolory).
    - Zastosowano bezpiecznÄ… pÄ™tlÄ™ sprawdzajÄ…cÄ… null-terminator przed pobraniem koloru, zapobiegajÄ…c odczytom poza zakresem tablicy.
    - Wprowadzono `inout` dla rejestrÃ³w w bloku `asm!`, co wyeliminowaÅ‚o konflikty z LLVM.
* **Architecture: Stack Initialization & Global ASM**
    - ZastÄ…piono funkcjÄ™ `_start` (naked) blokiem `global_asm!`.
    - Zdefiniowano bezpieczny stos o rozmiarze 16 KB w sekcji `.bss`.
    - Ustawiono `RSP` za pomocÄ… `lea rsp, [stack_top]` oraz wyrÃ³wnano stos do 16 bajtÃ³w.
    - UmoÅ¼liwiono bezpieczne przekazywanie tablic tymczasowych (lokalnych) bezpoÅ›rednio w argumentach makr.

#### 2025-12-26
* **Enhancement: Nuclear Reboot Sequence**
    - Zaimplementowano wielostopniowy mechanizm restartu (F5):
        1. Port PCI `0xCF9` (Standard QEMU).
        2. Kontroler klawiatury `0x64` (Standard PS/2).
        3. Wymuszenie `Triple Fault` poprzez celowe uszkodzenie tablicy IDT (`lidt [rsp]`), gwarantujÄ…ce restart w kaÅ¼dym Å›rodowisku.

##### ğŸš€ Benefits of Optimizations
* **Minimalny rozmiar binarki**: UsuniÄ™cie sekcji debugowych i komentarzy zmniejsza sporo rozmiar pliku `.bin`, co pozwala na szybsze Å‚adowanie przez bootloader z ograniczonÄ… liczbÄ… sektorÃ³w.
* **StabilnoÅ›Ä‡ pamiÄ™ci (Memory Safety)**: DziÄ™ki rezerwacji stosu w sekcji `.bss`, mamy pewnoÅ›Ä‡, Å¼e dane lokalne Rusta nie nadpiszÄ… kodu kernela ani waÅ¼nych struktur danych BIOS/UEFI.
* **Poprawne linkowanie symboli**: Model kodu `small` gwarantuje, Å¼e relatywne skoki i adresowanie danych (RIP-relative addressing) dziaÅ‚ajÄ… poprawnie w obrÄ™bie pierwszych 2GB pamiÄ™ci RAM.
* **Predictable Execution**: UsuniÄ™cie Å›mieci z poczÄ…tku pliku sprawia, Å¼e pod adresem `0x8000` zawsze znajduje siÄ™ instrukcja wejÅ›cia (`_start`), co eliminuje ryzyko prÃ³by wykonania przez procesor tekstowych metadanych jako kodu.
* **Feature: Advanced Animated Clear**
    - Zaktualizowano makro `vga_clear_animated!` o obsÅ‚ugÄ™ dowolnej liczby znakÃ³w.
    - Wprowadzono automatyczne zawijanie wierszy (word wrap) podczas czyszczenia.
    - Zoptymalizowano pÄ™tlÄ™ opÃ³ÅºniajÄ…cÄ… w ASM, by dopasowywaÅ‚a tempo animacji do liczby znakÃ³w.
* **Reduced size from 28KB to 17KB**